<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart SI Unit Calculator | Whatmore Industries</title>
  <style>
    body { background: #111; color: #eee; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 2rem; }
    h2 { text-align: center; }
    #pretty-math-output, #pretty-input-output {
      font-size: 1.5em; min-height: 2em; color:#fff; margin-bottom:0.3em;
    }
    #input-box {
      width: 100%;
      font-size: 1.25rem;
      padding: 0.5rem 1rem;
      background: #181818;
      color: #0f0;
      border: 1px solid #444;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      box-sizing: border-box;
    }
    .calculator {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      gap: 5px;
    }
    button {
      width: 60px;
      height: 60px;
      font-size: 1.2em;
    }
    .wide { grid-column: span 2; }
    @media (max-width: 600px) {
      button { width: 40px; height: 40px; font-size: 1em;}
      .calculator { grid-template-columns: repeat(3, 40px); }
    }
  </style>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <h2>Smart SI Unit Calculator</h2>
  <div id="pretty-input-output"></div>
  <div style="font-size:2em; text-align:center; margin-bottom: 0.5em;">=</div>
  <div id="pretty-math-output"></div>
  <div style="display:flex;align-items:center;margin-bottom:0.7em;">
    <button id="copy-latex-btn" style="margin-left:8px;padding:4px 8px;font-size:1em;cursor:pointer;">ðŸ“‹</button>
  </div>
  <input id="input-box"
    placeholder="Enter calculation (e.g. 5 / 9xxx)"
    autocomplete="off"
    oninput="updatePrettyInput(); calculate();"
    onkeydown="if(event.key==='Enter'){calculate(); return false;}">

  <div class="calculator">
    <button onclick="appendCalc('1')">1</button>
    <button onclick="appendCalc('2')">2</button>
    <button onclick="appendCalc('3')">3</button>
    <button onclick="appendCalc('4')">4</button>
    <button onclick="appendCalc('5')">5</button>
    <button onclick="appendCalc('6')">6</button>
    <button onclick="appendCalc('7')">7</button>
    <button onclick="appendCalc('8')">8</button>
    <button onclick="appendCalc('9')">9</button>
    <button onclick="appendCalc('.')">.</button>
    <button onclick="appendCalc('0')">0</button>
    <button onclick="calculate()">=</button>
    <button class="wide" onclick="backspace()">Backspace</button>
    <button class="wide" onclick="clearCalc()">Clear</button>
  </div>
  <div class="calculator" style="margin-bottom: 8px;">
    <button onclick="appendCalc('x')">x</button>
    <button onclick="appendCalc('y')">y</button>
    <button onclick="appendCalc('z')">z</button>
    <button onclick="appendCalc('a')">a</button>
    <button onclick="appendCalc('b')">b</button>
    <button onclick="appendCalc('c')">c</button>
    <button onclick="appendCalc('^')">^</button>
  </div>
  <div style="margin:1rem 0;">
    <button onclick="appendCalc(' + ')">+</button>
    <button onclick="appendCalc(' - ')">-</button>
    <button onclick="appendCalc(' * ')">*</button>
    <button onclick="appendCalc(' / ')">/</button>
  </div>
  <div>
    <strong>Length</strong><br>
    <button onclick="appendCalc(' nm ')">nm</button>
    <button onclick="appendCalc(' Î¼m ')">Î¼m</button>
    <button onclick="appendCalc(' mm ')">mm</button>
    <button onclick="appendCalc(' cm ')">cm</button>
    <button onclick="appendCalc(' m ')">m</button>
    <button onclick="appendCalc(' km ')">km</button>
    <button onclick="appendCalc(' in ')">in</button>
    <button onclick="appendCalc(' ft ')">ft</button>
    <button onclick="appendCalc(' yd ')">yd</button>
    <button onclick="appendCalc(' mi ')">mi</button>
  </div>
  <div>
    <strong>Mass</strong><br>
    <button onclick="appendCalc(' mg ')">mg</button>
    <button onclick="appendCalc(' g ')">g</button>
    <button onclick="appendCalc(' kg ')">kg</button>
    <button onclick="appendCalc(' t ')">t</button>
    <button onclick="appendCalc(' oz ')">oz</button>
    <button onclick="appendCalc(' lb ')">lb</button>
    <button onclick="appendCalc(' st ')">st</button>
  </div>
  <div>
    <strong>Time</strong><br>
    <button onclick="appendCalc(' ns ')">ns</button>
    <button onclick="appendCalc(' Î¼s ')">Î¼s</button>
    <button onclick="appendCalc(' ms ')">ms</button>
    <button onclick="appendCalc(' s ')">s</button>
    <button onclick="appendCalc(' min ')">min</button>
    <button onclick="appendCalc(' hr ')">hr</button>
    <button onclick="appendCalc(' day ')">day</button>
  </div>
  <div>
    <strong>Electricity</strong><br>
    <button onclick="appendCalc(' A ')">A</button>
    <button onclick="appendCalc(' V ')">V</button>
    <button onclick="appendCalc(' W ')">W</button>
    <button onclick="appendCalc(' F ')">F</button>
    <button onclick="appendCalc(' Î© ')">Î©</button>
    <button onclick="appendCalc(' C ')">C</button>
  </div>

<script>
function toRepeatingDecimal(num, maxDecimals = 20) {
  let str = num.toString();
  if (!str.includes('.')) return str;
  let frac = num % 1;
  for (let i = 1; i < maxDecimals; i++) {
    let candidate = Math.round(frac * Math.pow(10, i));
    if (candidate === Math.pow(10, i) - 1) {
      let base = Math.floor(num);
      let repDigit = Math.round(frac * Math.pow(10, i)) % 10;
      return `${base === 0 ? '' : base}.\\overline{${repDigit}}`;
    }
  }
  return num.toPrecision(10);
}
function formatInputAsLatex(input) {
  input = input.replace(/\s+/g, '');
  let fracMatch = input.match(/^(.+?)\/(.+)$/);
  if (fracMatch) {
    return `\\displaystyle\\frac{${fracMatch[1]}}{${fracMatch[2]}}`;
  } else {
    return input.replace(/([a-zA-Z]+)/g, "\\mathit{$1}");
  }
}
function updatePrettyInput() {
  let input = document.getElementById('input-box').value;
  let prettyDiv = document.getElementById('pretty-input-output');
  if (!input.trim()) {
    prettyDiv.innerHTML = '';
    MathJax.typesetPromise();
    return;
  }
  prettyDiv.innerHTML = `\\(${formatInputAsLatex(input)}\\)`;
  MathJax.typesetPromise();
}
function calculate() {
  let prettyDiv = document.getElementById('pretty-math-output');
  let input = document.getElementById('input-box').value.trim();

  // Only process if input is a fraction (with possible variable string in denominator)
  let fracMatch = input.replace(/\s+/g,'').match(/^([\d.]+)\s*\/\s*([\d.]+)([a-zA-Z]*)$/);
  if (fracMatch) {
    let numerator = fracMatch[1], denominatorNum = fracMatch[2], denominatorVars = fracMatch[3] || '';
    // Simplify variable string to powers (e.g., xxx -> x^3)
    let varCounts = {};
    for (let char of denominatorVars) {
      varCounts[char] = (varCounts[char]||0)+1;
    }
    let simpVarLatex = Object.entries(varCounts).map(([v,c])=>c>1?`${v}^{${c}}`:v).join('');
    // Compose LaTeX steps
    let origLatex = `\\displaystyle\\frac{${numerator}}{${denominatorNum}${denominatorVars}}`;
    let simpLatex = `\\displaystyle\\frac{${numerator}}{${denominatorNum}${simpVarLatex}}`;
    let dec = parseFloat(numerator) / parseFloat(denominatorNum);
    let decLatex = toRepeatingDecimal(dec);
    let decFracLatex = `\\displaystyle\\frac{${decLatex}}{${simpVarLatex}}`;
    let fullDecLatex = `${decLatex}\\,${Object.entries(varCounts).map(([v,c])=>`${v}^{-${c}}`).join('')}`;
    prettyDiv.innerHTML = 
      `= ${origLatex}<br>
       = ${simpLatex}<br>
       = ${decFracLatex}<br>
       = ${fullDecLatex}`;
    MathJax.typesetPromise();
    return;
  }
  // Fallback for non-fraction input (clear steps)
  prettyDiv.innerHTML = '';
  MathJax.typesetPromise();
}
document.getElementById('copy-latex-btn').onclick = function() {
  let latex = document.getElementById('pretty-math-output').innerText;
  if (!latex) return;
  navigator.clipboard.writeText(latex)
    .then(() => {
      let btn = document.getElementById('copy-latex-btn');
      btn.textContent = 'âœ…';
      setTimeout(() => btn.textContent = 'ðŸ“‹', 800);
    });
};
window.onload = function() {
  updatePrettyInput();
  calculate();
};
function appendCalc(val) {
  const box = document.getElementById('input-box');
  if (!box) return;
  const start = box.selectionStart;
  const end = box.selectionEnd;
  const text = box.value;
  box.value = text.slice(0, start) + val + text.slice(end);
  const caretPos = start + val.length;
  box.setSelectionRange(caretPos, caretPos);
  box.focus();
  updatePrettyInput();
  calculate();
}
function clearCalc() {
  document.getElementById('input-box').value = '';
  updatePrettyInput();
  calculate();
}
function backspace() {
  const box = document.getElementById('input-box');
  const start = box.selectionStart;
  const end = box.selectionEnd;
  if (start === end && start > 0) {
    box.value = box.value.slice(0, start-1) + box.value.slice(end);
    box.setSelectionRange(start-1, start-1);
  } else {
    box.value = box.value.slice(0, start) + box.value.slice(end);
    box.setSelectionRange(start, start);
  }
  box.focus();
  updatePrettyInput();
  calculate();
}
</script>
</body>
</html>
