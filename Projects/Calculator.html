<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Unit Calculator | Whatmore Industries</title>
  <style>
    body { background: #111; color: #eee; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 2rem; }
    h2 { text-align: center; }
    #input-box {
      width: 100%;
      font-size: 1.25rem;
      padding: 0.5rem 1rem;
      background: #181818;
      color: #0f0;
      border: 1px solid #444;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      box-sizing: border-box;
    }
    #result-panel {
      background: #222;
      padding: 1rem;
      border-radius: 0.9rem;
      font-size: 1rem;
      margin-top: 1rem;
      min-height: 60px;
    }
    .section-label { font-weight: bold; color: #0ff; margin-top: 0.5em; }
    .calculator {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      gap: 5px;
    }
    button {
      width: 60px;
      height: 60px;
      font-size: 1.2em;
    }
    .wide { grid-column: span 2; }
    .output-row { margin-bottom: 0.3em; }
    .unit-breakdown { color: #6cf; font-family: 'Consolas', monospace; }
  </style>
</head>
<body>
  <h2>Smart Unit Calculator</h2>
  <input id="input-box" placeholder="Enter calculation (e.g. 0.5 Nm, 2 m + 3 m)" autocomplete="off"
    onkeydown="if(event.key==='Enter'){calculate();}">
  <div class="calculator">
    <button onclick="appendCalc('1')">1</button>
    <button onclick="appendCalc('2')">2</button>
    <button onclick="appendCalc('3')">3</button>
    <button onclick="appendCalc('4')">4</button>
    <button onclick="appendCalc('5')">5</button>
    <button onclick="appendCalc('6')">6</button>
    <button onclick="appendCalc('7')">7</button>
    <button onclick="appendCalc('8')">8</button>
    <button onclick="appendCalc('9')">9</button>
    <button onclick="appendCalc('.')">.</button>
    <button onclick="appendCalc('0')">0</button>
    <button onclick="calculate()">=</button>
    <button class="wide" onclick="backspace()">Backspace</button>
    <button class="wide" onclick="clearCalc()">Clear</button>
  </div>
  <div class="calculator" style="margin-bottom: 8px;">
  <button onclick="appendCalc('x')">x</button>
  <button onclick="appendCalc('y')">y</button>
  <button onclick="appendCalc('z')">z</button>
  <button onclick="appendCalc('a')">a</button>
  <button onclick="appendCalc('b')">b</button>
  <button onclick="appendCalc('c')">c</button>
  <button onclick="appendCalc('^')">^</button>
</div>

  <div style="margin:1rem 0;">
    <button onclick="appendCalc(' + ')">+</button>
    <button onclick="appendCalc(' - ')">-</button>
    <button onclick="appendCalc(' * ')">*</button>
    <button onclick="appendCalc(' / ')">/</button>
  </div>
  <div>
    <strong>Length</strong><br>
    <button onclick="appendCalc(' nm ')">nm</button>
    <button onclick="appendCalc(' μm ')">μm</button>
    <button onclick="appendCalc(' mm ')">mm</button>
    <button onclick="appendCalc(' cm ')">cm</button>
    <button onclick="appendCalc(' m ')">m</button>
    <button onclick="appendCalc(' km ')">km</button>
    <button onclick="appendCalc(' in ')">in</button>
    <button onclick="appendCalc(' ft ')">ft</button>
    <button onclick="appendCalc(' yd ')">yd</button>
    <button onclick="appendCalc(' mi ')">mi</button>
  </div>
  <div>
    <strong>Mass</strong><br>
    <button onclick="appendCalc(' mg ')">mg</button>
    <button onclick="appendCalc(' g ')">g</button>
    <button onclick="appendCalc(' kg ')">kg</button>
    <button onclick="appendCalc(' t ')">t</button>
    <button onclick="appendCalc(' oz ')">oz</button>
    <button onclick="appendCalc(' lb ')">lb</button>
    <button onclick="appendCalc(' st ')">st</button>
  </div>
  <div>
    <strong>Time</strong><br>
    <button onclick="appendCalc(' ns ')">ns</button>
    <button onclick="appendCalc(' μs ')">μs</button>
    <button onclick="appendCalc(' ms ')">ms</button>
    <button onclick="appendCalc(' s ')">s</button>
    <button onclick="appendCalc(' min ')">min</button>
    <button onclick="appendCalc(' hr ')">hr</button>
    <button onclick="appendCalc(' day ')">day</button>
  </div>
  <div>
    <strong>Electricity</strong><br>
    <button onclick="appendCalc(' A ')">A</button>
    <button onclick="appendCalc(' V ')">V</button>
    <button onclick="appendCalc(' W ')">W</button>
    <button onclick="appendCalc(' F ')">F</button>
    <button onclick="appendCalc(' Ω ')">Ω</button>
    <button onclick="appendCalc(' C ')">C</button>
  </div>
  <div id="result-panel"></div>

  <script>
    const siBase = {
      kg: {dim: {kg:1}, factor:1}, 
      m:  {dim: {m:1},  factor:1},
      s:  {dim: {s:1},  factor:1},
      A:  {dim: {A:1},  factor:1},
      K:  {dim: {K:1},  factor:1},
      mol:{dim:{mol:1}, factor:1},
      cd: {dim:{cd:1},  factor:1},
    };

    const units = {
      nm: {base:'m', factor:1e-9}, 'μm':{base:'m',factor:1e-6}, mm:{base:'m',factor:1e-3},
      cm: {base:'m', factor:1e-2}, m:{base:'m',factor:1}, km:{base:'m',factor:1e3},
      in: {base:'m', factor:0.0254}, ft:{base:'m',factor:0.3048}, yd:{base:'m',factor:0.9144}, mi:{base:'m',factor:1609.34},
      mg: {base:'kg', factor:1e-6}, g:{base:'kg',factor:1e-3}, kg:{base:'kg',factor:1}, t:{base:'kg',factor:1000},
      oz: {base:'kg', factor:0.0283495}, lb:{base:'kg',factor:0.453592}, st:{base:'kg',factor:6.35029},
      ns:{base:'s',factor:1e-9}, 'μs':{base:'s',factor:1e-6}, ms:{base:'s',factor:1e-3},
      s:{base:'s',factor:1}, min:{base:'s',factor:60}, hr:{base:'s',factor:3600}, day:{base:'s',factor:86400},
      A:{base:'A',factor:1}, V:{base:'V',factor:1}, W:{base:'W',factor:1}, F:{base:'F',factor:1}, 'Ω':{base:'Ω',factor:1}, C:{base:'C',factor:1}
    };

    const derivedSI = {
      N: "kg·m/s²",
      J: "kg·m²/s²",
      W: "kg·m²/s³",
      Pa: "kg/m·s²",
      V: "kg·m²/s³·A⁻¹",
      C: "A·s",
      F: "s⁴·A²/kg·m²",
      Ω: "kg·m²/s³·A²",
      S: "s³·A²/kg·m²",
      H: "kg·m²/s²·A²"
    };

    function decimalToFraction(value, maxDenom=10000) {
      let num = value, denom = 1, bestNum = 1, bestDenom = 1, bestError = Math.abs(value-1);
      for (let d=1; d<=maxDenom; d++) {
        let n = Math.round(value*d);
        let error = Math.abs(value - n/d);
        if (error < bestError) {
          bestNum = n; bestDenom = d; bestError = error;
        }
        if (bestError < 1e-8) break;
      }
      return (bestDenom === 1) ? bestNum.toString() : `${bestNum}/${bestDenom}`;
    }

    function appendCalc(val) {
      const box = document.getElementById('input-box');
      box.value += val;
      box.focus();
    }

    function clearCalc() {
      document.getElementById('input-box').value = '';
      document.getElementById('result-panel').innerHTML = '';
    }

    function backspace() {
      const box = document.getElementById('input-box');
      box.value = box.value.slice(0, -1);
      box.focus();
    }

 function calculate() {
  let panel = document.getElementById('result-panel');
  panel.innerHTML = '';
  let input = document.getElementById('input-box').value.trim();

  // Split on + and - operators, preserve sign with each term
  let termRegex = /([+\-]?[^+\-]+)/g;
  let terms = [];
  let match;
  while ((match = termRegex.exec(input)) !== null) {
    let seg = match[0].trim();
    if (seg) terms.push(seg);
  }

  if (terms.length === 0) {
    panel.innerHTML = `<span style='color:red;'>Could not parse input.<br>Try: 0.5 Nm or 2 m + 3 m</span>`;
    return;
  }

  // Try to evaluate numeric/unit terms, echo others
  let evaluatedTerms = [];
  for (let seg of terms) {
    // Handle multiplication/division within a segment
    if (seg.match(/[*\/]/)) {
      let multParts = seg.split(/([*/])/);
      let val = null, unit = '', symbolic = false, symbolSegs = [];
      let lastOp = '*';
      for (let i = 0; i < multParts.length; i++) {
        let part = multParts[i].trim();
        if (part === '*' || part === '/') {
          lastOp = part;
        } else if (part.length) {
          let m = part.match(/^([+\-]?\d*\.?\d+|[+\-]?\d+)\s*([a-zA-ZμΩ]*)$/);
          if (!m) {
            // Not a plain number/unit; treat as symbolic (e.g. x, y, 3x, etc)
            symbolic = true;
            symbolSegs.push(part);
            continue;
          }
          let v = parseFloat(m[1]);
          let u = m[2] || '';
          if (val === null) {
            val = v;
            unit = u;
          } else {
            if (lastOp === '*') {
              val *= v;
            } else {
              val /= v;
            }
            if (!unit) unit = u;
          }
        }
      }
      if (symbolic || symbolSegs.length) {
        evaluatedTerms.push(seg);
      } else {
        evaluatedTerms.push((val !== null ? val : '') + (unit ? ' ' + unit : ''));
      }
    } else {
      // Single value/unit or variable
let m = seg.match(/^([+\-]?\d*\.?\d+|[+\-]?\d+)?\s*([a-zA-ZμΩ][a-zA-Z0-9]*(\^\d+)?)?$/);
if (m && (m[1] || m[2])) {
  let v = m[1] ? parseFloat(m[1]) : '';
  let u = m[2] || '';
  evaluatedTerms.push((v !== '' ? v : '') + (u ? ' ' + u : ''));
} else {
  evaluatedTerms.push(seg);
}

      }
    }
  }

  // Re-join for output
  let outStr = evaluatedTerms
  .map((term, i) => {
    // Clean up whitespace and signs
    term = term.trim();
    if (i === 0) return term;
    if (term.startsWith('-')) return ' - ' + term.slice(1).trim();
    return ' + ' + term.replace(/^\+/, '').trim();
  })
  .join('');

  // Fractional display: only for numeric/unit terms for now
let fracTerms = evaluatedTerms.map((t, i) => {
  let m = t.match(/^([+\-]?\d*\.?\d+|[+\-]?\d+)?\s*([a-zA-ZμΩ][a-zA-Z0-9]*(\^\d+)?)?$/);
  let frac = (m && m[1]) ? decimalToFraction(parseFloat(m[1])) + (m[2] ? ' ' + m[2] : '') : t;
  frac = frac.trim();
  if (i === 0) return frac;
  if (frac.startsWith('-')) return ' - ' + frac.slice(1).trim();
  return ' + ' + frac.replace(/^\+/, '').trim();
}).join('');



  // Output
  panel.innerHTML = `
    <div class='output-row'><span class='section-label'>Decimal:</span> ${outStr}</div>
    <div class='output-row'><span class='section-label'>Fraction:</span> ${fracTerms}</div>
  `;
}





    function printOutputs(value, unit) {
      let panel = document.getElementById('result-panel');
      let html = '';

      // Decimal
      html += `<div class='output-row'><span class='section-label'>Decimal:</span> ${value} ${unit}</div>`;

      // Fraction
      html += `<div class='output-row'><span class='section-label'>Fraction:</span> ${decimalToFraction(value)} ${unit}</div>`;

      // Downscale/upscale logic for SI prefixes (simple)
      let base = units[unit] ? units[unit].base : unit;
      let scaledValue = value, scaledUnit = unit;
      if (unit && units[unit]) {
        if (Math.abs(value) >= 1000 && units[base+'m']) {
          scaledValue = value * units[unit].factor / units[base+'m'].factor;
          scaledUnit = base + 'm';
        } else if (Math.abs(value) < 1 && units['m'+unit]) {
          scaledValue = value * units[unit].factor / units['m'+unit].factor;
          scaledUnit = 'm' + unit;
        }
        if (scaledUnit !== unit) {
          html += `<div class='output-row'><span class='section-label'>Scaled:</span> ${scaledValue} ${scaledUnit}</div>`;
        }
      }

      // SI breakdown
      let siString = '';
      if (derivedSI[unit]) {
        siString = derivedSI[unit];
      } else if (base && derivedSI[base]) {
        siString = derivedSI[base];
      }
      if (siString) {
        html += `<div class='output-row'><span class='section-label'>SI breakdown:</span> <span class='unit-breakdown'>${value} ${siString}</span></div>`;
      }
      panel.innerHTML = html;
    }
  </script>
</body>
</html>
