<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart SI Unit Calculator | Whatmore Industries</title>
  <style>
    body { background: #111; color: #eee; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 2rem; }
    h2 { text-align: center; }
    #pretty-input-output {
      display: none; /* input is shown in steps, not standalone */
    }
    .eq-steps-container {
      width: 100%;
      max-width: 600px;
      margin: 0 auto 1.2em auto;
      position: relative;
    }
    .steps-eq-row {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      min-height: 2em;
      margin-bottom: 0.8em;
    }
    .steps-side {
      flex: 1 1 0;
      min-width: 140px;
      max-width: 320px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      font-size: 1.4em;
      word-break: break-all;
      white-space: normal;
      padding-right: 0.4em;
      box-sizing: border-box;
    }
    .steps-side.right {
      justify-content: flex-start;
      padding-right: 0;
      padding-left: 0.4em;
    }
    .eq-label {
      font-size: 1.6em;
      color: #fff;
      flex: none;
      margin: 0 0.18em;
      z-index: 1;
      background: #111;
      padding: 0 0.1em;
      position: relative;
      min-width: 1.4em;
      text-align: center;
    }
    .steps-eq-latex { font-size: 1em; color: #fff;}
    #input-box {
      width: 100%;
      font-size: 1.25rem;
      padding: 0.5rem 1rem;
      background: #181818;
      color: #0f0;
      border: 1px solid #444;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      box-sizing: border-box;
    }
    #result-panel {
      background: #222;
      padding: 1rem;
      border-radius: 0.9rem;
      font-size: 1rem;
      margin-top: 1rem;
      min-height: 60px;
    }
    .section-label { font-weight: bold; color: #0ff; margin-top: 0.5em; }
    .calculator {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      gap: 5px;
    }
    button {
      width: 60px;
      height: 60px;
      font-size: 1.2em;
    }
    .wide { grid-column: span 2; }
    .output-row { margin-bottom: 0.3em; }
    .unit-breakdown { color: #6cf; font-family: 'Consolas', monospace; }
    .sigfig-active { background: #0ff; color: #111; }
  </style>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <h2>Smart SI Unit Calculator</h2>
  <div class="eq-steps-container">
    <div id="steps-math-output"></div>
  </div>
  <div style="display:flex;align-items:center;margin-bottom:0.7em;">
    <button id="copy-latex-btn" style="margin-left:8px;padding:4px 8px;font-size:1em;cursor:pointer;">ðŸ“‹</button>
  </div>
  <input id="input-box"
    placeholder="Enter calculation (e.g. 5 / 9xxx)"
    autocomplete="off"
    oninput="calculate();"
    onkeydown="if(event.key==='Enter'){calculate(); return false;}">

  <div style="margin-bottom:0.5em;">
    Significant figures: 
    <button class="sigfig-btn" onclick="setSigFigs(3)">3</button>
    <button class="sigfig-btn" onclick="setSigFigs(6)">6</button>
    <button class="sigfig-btn" onclick="setSigFigs(10)">10</button>
  </div>
  <div style="margin-bottom: 1em;">
    <label for="unit-system">Unit System:</label>
    <select id="unit-system" onchange="updateUnitOptions()">
      <option value="metric">Metric (SI)</option>
      <option value="imperial">Imperial (US)</option>
    </select>
    <label for="discipline" style="margin-left: 1em;">Discipline:</label>
    <select id="discipline" onchange="updateUnitOptions()">
      <option value="electrical">Electrical</option>
      <option value="mechanical">Mechanical</option>
    </select>
  </div>
  <div id="unit-buttons-area" style="margin-bottom: 1.2em;"></div>
  <div class="calculator">
    <button onclick="appendCalc('1')">1</button>
    <button onclick="appendCalc('2')">2</button>
    <button onclick="appendCalc('3')">3</button>
    <button onclick="appendCalc('4')">4</button>
    <button onclick="appendCalc('5')">5</button>
    <button onclick="appendCalc('6')">6</button>
    <button onclick="appendCalc('7')">7</button>
    <button onclick="appendCalc('8')">8</button>
    <button onclick="appendCalc('9')">9</button>
    <button onclick="appendCalc('.')">.</button>
    <button onclick="appendCalc('0')">0</button>
    <button onclick="calculate()">=</button>
    <button class="wide" onclick="backspace()">Backspace</button>
    <button class="wide" onclick="clearCalc()">Clear</button>
  </div>
  <div class="calculator" style="margin-bottom: 8px;">
    <button onclick="appendCalc('x')">x</button>
    <button onclick="appendCalc('y')">y</button>
    <button onclick="appendCalc('z')">z</button>
    <button onclick="appendCalc('a')">a</button>
    <button onclick="appendCalc('b')">b</button>
    <button onclick="appendCalc('c')">c</button>
    <button onclick="appendCalc('^')">^</button>
  </div>
  <div style="margin:1rem 0;">
    <button onclick="appendCalc(' + ')">+</button>
    <button onclick="appendCalc(' - ')">-</button>
    <button onclick="appendCalc(' * ')">*</button>
    <button onclick="appendCalc(' / ')">/</button>
  </div>
  <!-- Example unit buttons, add your own as needed -->
  <!--<div>
    <strong>Length</strong><br>
    <button onclick="appendCalc(' nm ')">nm</button>
    <button onclick="appendCalc(' Î¼m ')">Î¼m</button>
    <button onclick="appendCalc(' mm ')">mm</button>
    <button onclick="appendCalc(' cm ')">cm</button>
    <button onclick="appendCalc(' m ')">m</button>
    <button onclick="appendCalc(' km ')">km</button>
    <button onclick="appendCalc(' in ')">in</button>
    <button onclick="appendCalc(' ft ')">ft</button>
    <button onclick="appendCalc(' yd ')">yd</button>
    <button onclick="appendCalc(' mi ')">mi</button>
  </div>
  <div>
    <strong>Mass</strong><br>
    <button onclick="appendCalc(' mg ')">mg</button>
    <button onclick="appendCalc(' g ')">g</button>
    <button onclick="appendCalc(' kg ')">kg</button>
    <button onclick="appendCalc(' t ')">t</button>
    <button onclick="appendCalc(' oz ')">oz</button>
    <button onclick="appendCalc(' lb ')">lb</button>
    <button onclick="appendCalc(' st ')">st</button>
  </div>
  <div>
    <strong>Time</strong><br>
    <button onclick="appendCalc(' ns ')">ns</button>
    <button onclick="appendCalc(' Î¼s ')">Î¼s</button>
    <button onclick="appendCalc(' ms ')">ms</button>
    <button onclick="appendCalc(' s ')">s</button>
    <button onclick="appendCalc(' min ')">min</button>
    <button onclick="appendCalc(' hr ')">hr</button>
    <button onclick="appendCalc(' day ')">day</button>
  </div>
  <div>
    <strong>Electricity</strong><br>
    <button onclick="appendCalc(' A ')">A</button>
    <button onclick="appendCalc(' V ')">V</button>
    <button onclick="appendCalc(' W ')">W</button>
    <button onclick="appendCalc(' F ')">F</button>
    <button onclick="appendCalc(' Î© ')">Î©</button>
    <button onclick="appendCalc(' C ')">C</button>
  </div>-->
  <div id="result-panel"></div>
<script>
function formatSigFig(num, sigfigs) {
  if (isNaN(num)) return '?';
  if (num === 0) return '0';
  let s = Number(num).toPrecision(sigfigs);
  if (s.includes('e')) return s;
  s = s.replace(/\.?0+$/, '');
  return s;
}
function formatInputAsLatex(input) {
  input = input.replace(/\s+/g, '');
  let fracMatch = input.match(/^(.+?)\/(.+)$/);
  if (fracMatch) {
    return `\\displaystyle\\frac{${fracMatch[1]}}{${fracMatch[2]}}`;
  } else {
    return input.replace(/([a-zA-Z]+)/g, "\\mathit{$1}");
  }
}
let currentSigFigs = 3;
function setSigFigs(n) {
  currentSigFigs = n;
  document.querySelectorAll('.sigfig-btn').forEach(btn => {
    btn.classList.toggle('sigfig-active', btn.textContent == n);
  });
  calculate();
}
function appendCalc(val) {
  const box = document.getElementById('input-box');
  if (!box) return;
  const start = box.selectionStart;
  const end = box.selectionEnd;
  const text = box.value;
  box.value = text.slice(0, start) + val + text.slice(end);
  const caretPos = start + val.length;
  box.setSelectionRange(caretPos, caretPos);
  box.focus();
  calculate();
}
function clearCalc() {
  document.getElementById('input-box').value = '';
  document.getElementById('result-panel').innerHTML = '';
  document.getElementById('steps-math-output').innerHTML = '';
  calculate();
}
function backspace() {
  const box = document.getElementById('input-box');
  const start = box.selectionStart;
  const end = box.selectionEnd;
  if (start === end && start > 0) {
    box.value = box.value.slice(0, start-1) + box.value.slice(end);
    box.setSelectionRange(start-1, start-1);
  } else {
    box.value = box.value.slice(0, start) + box.value.slice(end);
    box.setSelectionRange(start, start);
  }
  box.focus();
  calculate();
}
function updateUnitOptions() {
  // Your custom unit button code can go here
}
function calculate() {
  let stepsDiv = document.getElementById('steps-math-output');
  let input = document.getElementById('input-box').value.trim();
  let inputLatex = input ? `\\(${formatInputAsLatex(input)}\\)` : '';
  let steps = [];
  // Fraction (both numbers): "5.5/5"
  let fracMatch = input.replace(/\s+/g,'').match(/^(.+?)\/(.+)$/);
  if (input && fracMatch && !isNaN(Number(fracMatch[1])) && !isNaN(Number(fracMatch[2]))) {
    try {
      let expr = input.replace(/[a-zA-ZÎ¼Î©]+/g, '').replace(/\s+/g, '');
      let result = Function('"use strict";return (' + expr + ')')();
      let formattedResult = formatSigFig(result, currentSigFigs);
      steps.push(`
        <div class="steps-eq-row">
          <span class="steps-side">${inputLatex}</span>
          <span class="eq-label">=</span>
          <span class="steps-side right"><span class="steps-eq-latex">\\(${formattedResult}\\)</span></span>
        </div>
      `);
      stepsDiv.innerHTML = steps.join('');
      MathJax.typesetPromise([stepsDiv]);
    } catch(e) { stepsDiv.innerHTML = ''; }
    return;
  }
  // Symbolic fractions (with units/vars)
  if (input && fracMatch) {
    let numerator = fracMatch[1], denominator = fracMatch[2];
    let denVars = denominator.match(/([a-zA-Z]+)/g);
    let denNumMatch = denominator.match(/^\d+/);
    let denNum = denNumMatch ? denNumMatch[0] : '1';
    let denVarPowers = {};
    if (denVars) {
      denVars.forEach(v => {
        let re = new RegExp(`${v}+`, 'g');
        let count = (denominator.match(re) || ['']).join('').length / v.length;
        denVarPowers[v] = count;
      });
    }
    let denPowLatex = Object.entries(denVarPowers).map(([v, c]) => c > 1 ? `${v}^{${c}}` : v).join('');
    let simpLatex = `\\displaystyle\\frac{${numerator}}{${denNum !== '1' ? denNum : ''}${denPowLatex}}`;
    let numVal = parseFloat(numerator);
    let denVal = parseFloat(denNum);
    let dec = (!isNaN(numVal) && !isNaN(denVal) && denVal !== 0) ? numVal / denVal : NaN;
    let formattedDec = formatSigFig(dec, currentSigFigs);
    let repLatex = (!isNaN(dec)) ? formattedDec : '?';
    let decFracLatex = `\\displaystyle\\frac{${repLatex}}{${denPowLatex}}`;
    let fullDecLatex = `${repLatex}${Object.entries(denVarPowers).length > 0 ? '\\,' : ''}${Object.entries(denVarPowers).map(([v,c])=>`${v}^{-${c}}`).join('')}`;
    // Steps:
    [simpLatex, decFracLatex, fullDecLatex].forEach(latex => {
      steps.push(`
        <div class="steps-eq-row">
          <span class="steps-side"></span>
          <span class="eq-label">=</span>
          <span class="steps-side right"><span class="steps-eq-latex">\\(${latex}\\)</span></span>
        </div>
      `);
    });
    stepsDiv.innerHTML = steps.join('');
    MathJax.typesetPromise([stepsDiv]);
    return;
  }
  // Basic number or expression (no fraction slash)
  if (input) {
    try {
      let expr = input.replace(/[a-zA-ZÎ¼Î©]+/g, '').replace(/\s+/g, '');
      let result = Function('"use strict";return (' + expr + ')')();
      let formattedResult = formatSigFig(result, currentSigFigs);
      steps.push(`
        <div class="steps-eq-row">
          <span class="steps-side">${inputLatex}</span>
          <span class="eq-label">=</span>
          <span class="steps-side right"><span class="steps-eq-latex">\\(${formattedResult}\\)</span></span>
        </div>
      `);
      stepsDiv.innerHTML = steps.join('');
      MathJax.typesetPromise([stepsDiv]);
    } catch(e) {
      stepsDiv.innerHTML = '';
    }
    return;
  }
  stepsDiv.innerHTML = '';
}
document.getElementById('copy-latex-btn').onclick = function() {
  let stepsDiv = document.getElementById('steps-math-output');
  if (!stepsDiv.textContent) return;
  navigator.clipboard.writeText(stepsDiv.textContent)
    .then(() => {
      let btn = document.getElementById('copy-latex-btn');
      btn.textContent = 'âœ…';
      setTimeout(() => btn.textContent = 'ðŸ“‹', 800);
    });
};
window.onload = function() {
  calculate();
  updateUnitOptions && updateUnitOptions();
};
</script>
</body>
</html>
