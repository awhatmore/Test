<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart SI Unit Calculator | Whatmore Industries</title>
  <style>
    body { background: #111; color: #eee; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 2rem; }
    h2 { text-align: center; }
    #main-math-block {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 1em;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .math-row {
      display: flex;
      align-items: center;
      font-size: 1.6em;
      min-height: 2em;
      color: #fff;
      font-family: inherit;
    }
    .eq-sign {
      color: #0ff;
      font-weight: bold;
      min-width: 1.2em;
      text-align: right;
      margin-right: 0.3em;
      flex-shrink: 0;
      font-family: inherit;
    }
    .pretty-math {
      min-width: 3em;
      text-align: left;
      font-size: 1em;
      font-family: inherit;
    }
    #steps-output .math-row {
      font-size: 1.3em;
      margin-top: 0.1em;
      margin-bottom: 0.05em;
      color: #fff;
    }
    #input-box {
      width: 100%;
      font-size: 1.25rem;
      padding: 0.5rem 1rem;
      background: #181818;
      color: #0f0;
      border: 1px solid #444;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      box-sizing: border-box;
    }
    .calculator {
      display: grid;
      grid-template-columns: repeat(3, 60px);
      gap: 5px;
    }
    button {
      width: 60px;
      height: 60px;
      font-size: 1.2em;
    }
    .wide { grid-column: span 2; }
    @media (max-width: 600px) {
      button { width: 40px; height: 40px; font-size: 1em;}
      .calculator { grid-template-columns: repeat(3, 40px); }
    }
  </style>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <h2>Smart SI Unit Calculator</h2>
  <div id="main-math-block">
    <div class="math-row">
      <span id="pretty-input-output" class="pretty-math"></span>
      <span class="eq-sign" id="main-equals">=</span>
      <span id="pretty-simp-output" class="pretty-math"></span>
    </div>
    <div id="steps-output"></div>
    <div style="display:flex;align-items:center;margin: 0.5em 0;">
      <button id="copy-latex-btn" style="margin-left:8px;padding:4px 8px;font-size:1em;cursor:pointer;">ðŸ“‹</button>
    </div>
  </div>
  <input id="input-box"
    placeholder="Enter calculation (e.g. 5 / 9xxx)"
    autocomplete="off"
    oninput="updatePrettyInput(); calculate();"
    onkeydown="if(event.key==='Enter'){calculate(); return false;}">

  <div class="calculator">
    <button onclick="appendCalc('1')">1</button>
    <button onclick="appendCalc('2')">2</button>
    <button onclick="appendCalc('3')">3</button>
    <button onclick="appendCalc('4')">4</button>
    <button onclick="appendCalc('5')">5</button>
    <button onclick="appendCalc('6')">6</button>
    <button onclick="appendCalc('7')">7</button>
    <button onclick="appendCalc('8')">8</button>
    <button onclick="appendCalc('9')">9</button>
    <button onclick="appendCalc('.')">.</button>
    <button onclick="appendCalc('0')">0</button>
    <button onclick="calculate()">=</button>
    <button class="wide" onclick="backspace()">Backspace</button>
    <button class="wide" onclick="clearCalc()">Clear</button>
  </div>
  <div class="calculator" style="margin-bottom: 8px;">
    <button onclick="appendCalc('x')">x</button>
    <button onclick="appendCalc('y')">y</button>
    <button onclick="appendCalc('z')">z</button>
    <button onclick="appendCalc('a')">a</button>
    <button onclick="appendCalc('b')">b</button>
    <button onclick="appendCalc('c')">c</button>
    <button onclick="appendCalc('^')">^</button>
  </div>
  <div style="margin:1rem 0;">
    <button onclick="appendCalc(' + ')">+</button>
    <button onclick="appendCalc(' - ')">-</button>
    <button onclick="appendCalc(' * ')">*</button>
    <button onclick="appendCalc(' / ')">/</button>
  </div>
  <div>
    <strong>Length</strong><br>
    <button onclick="appendCalc(' nm ')">nm</button>
    <button onclick="appendCalc(' Î¼m ')">Î¼m</button>
    <button onclick="appendCalc(' mm ')">mm</button>
    <button onclick="appendCalc(' cm ')">cm</button>
    <button onclick="appendCalc(' m ')">m</button>
    <button onclick="appendCalc(' km ')">km</button>
    <button onclick="appendCalc(' in ')">in</button>
    <button onclick="appendCalc(' ft ')">ft</button>
    <button onclick="appendCalc(' yd ')">yd</button>
    <button onclick="appendCalc(' mi ')">mi</button>
  </div>
  <div>
    <strong>Mass</strong><br>
    <button onclick="appendCalc(' mg ')">mg</button>
    <button onclick="appendCalc(' g ')">g</button>
    <button onclick="appendCalc(' kg ')">kg</button>
    <button onclick="appendCalc(' t ')">t</button>
    <button onclick="appendCalc(' oz ')">oz</button>
    <button onclick="appendCalc(' lb ')">lb</button>
    <button onclick="appendCalc(' st ')">st</button>
  </div>
  <div>
    <strong>Time</strong><br>
    <button onclick="appendCalc(' ns ')">ns</button>
    <button onclick="appendCalc(' Î¼s ')">Î¼s</button>
    <button onclick="appendCalc(' ms ')">ms</button>
    <button onclick="appendCalc(' s ')">s</button>
    <button onclick="appendCalc(' min ')">min</button>
    <button onclick="appendCalc(' hr ')">hr</button>
    <button onclick="appendCalc(' day ')">day</button>
  </div>
  <div>
    <strong>Electricity</strong><br>
    <button onclick="appendCalc(' A ')">A</button>
    <button onclick="appendCalc(' V ')">V</button>
    <button onclick="appendCalc(' W ')">W</button>
    <button onclick="appendCalc(' F ')">F</button>
    <button onclick="appendCalc(' Î© ')">Î©</button>
    <button onclick="appendCalc(' C ')">C</button>
  </div>

<script>
function toRepeatingDecimal(num, maxDecimals = 20) {
  let str = num.toString();
  if (!str.includes('.')) return str;
  let frac = num % 1;
  for (let i = 1; i < maxDecimals; i++) {
    let candidate = Math.round(frac * Math.pow(10, i));
    if (candidate === Math.pow(10, i) - 1) {
      let base = Math.floor(num);
      let repDigit = Math.round(frac * Math.pow(10, i)) % 10;
      return `${base === 0 ? '' : base}.\\overline{${repDigit}}`;
    }
  }
  return num.toPrecision(10);
}
function formatInputAsLatex(input) {
  input = input.replace(/\s+/g, '');
  let fracMatch = input.match(/^(.+?)\/(.+)$/);
  if (fracMatch) {
    return `\\displaystyle\\frac{${fracMatch[1]}}{${fracMatch[2]}}`;
  } else {
    return input.replace(/([a-zA-Z]+)/g, "\\mathit{$1}");
  }
}
function updatePrettyInput() {
  let input = document.getElementById('input-box').value;
  let prettyInput = document.getElementById('pretty-input-output');
  if (!input.trim()) {
    prettyInput.innerHTML = '';
    document.getElementById('pretty-simp-output').innerHTML = '';
    MathJax.typesetPromise();
    return;
  }
  prettyInput.innerHTML = `\\(${formatInputAsLatex(input)}\\)`;
  MathJax.typesetPromise();
}
function calculate() {
  let input = document.getElementById('input-box').value.trim();
  let simpDiv = document.getElementById('pretty-simp-output');
  let stepsDiv = document.getElementById('steps-output');
  simpDiv.innerHTML = '';
  stepsDiv.innerHTML = '';
  // Only process if input is a fraction with number in numerator and denominator (plus vars)
  let fracMatch = input.replace(/\s+/g,'').match(/^([\d.]+)\s*\/\s*([\d.]+)([a-zA-Z]*)$/);
  if (fracMatch) {
    let numerator = fracMatch[1], denominatorNum = fracMatch[2], denominatorVars = fracMatch[3] || '';
    let varCounts = {};
    for (let char of denominatorVars) {
      varCounts[char] = (varCounts[char]||0)+1;
    }
    let simpVarLatex = Object.entries(varCounts).map(([v,c])=>c>1?`${v}^{${c}}`:v).join('');
    let origLatex = `\\displaystyle\\frac{${numerator}}{${denominatorNum}${denominatorVars}}`;
    let simpLatex = `\\displaystyle\\frac{${numerator}}{${denominatorNum}${simpVarLatex}}`;
    let dec = parseFloat(numerator) / parseFloat(denominatorNum);
    let decLatex = toRepeatingDecimal(dec);
    let decFracLatex = `\\displaystyle\\frac{${decLatex}}{${simpVarLatex}}`;
    let fullDecLatex = `${decLatex}\\,${Object.entries(varCounts).map(([v,c])=>`${v}^{-${c}}`).join('')}`;

    // The first line after input: 5/9xxx = 5/9x^3
    simpDiv.innerHTML = `\\(${simpLatex}\\)`;

    // Steps below, each with equals indented to line up vertically
    let eqPad = document.getElementById('main-equals').offsetLeft + document.getElementById('main-equals').offsetWidth;
    // We'll use a "ghost" eq-sign for vertical alignment
    let lines = [
      decFracLatex,
      fullDecLatex
    ];
    for(let line of lines) {
      let row = document.createElement('div');
      row.className = 'math-row';
      // indent equals to line up with above
      row.innerHTML = `<span class="eq-sign">&nbsp;&nbsp;&nbsp;=</span>
        <span class="pretty-math">\\(${line}\\)</span>`;
      stepsDiv.appendChild(row);
    }
    MathJax.typesetPromise();
    return;
  }
  // Fallback for non-fraction input (clear)
  simpDiv.innerHTML = '';
  stepsDiv.innerHTML = '';
  MathJax.typesetPromise();
}
document.getElementById('copy-latex-btn').onclick = function() {
  let eq = '=';
  let simp = document.getElementById('pretty-simp-output').textContent;
  let steps = document.querySelectorAll('#steps-output .pretty-math');
  let text = simp + '\n' + Array.from(steps).map(div => div.innerText).join('\n');
  if (!text) return;
  navigator.clipboard.writeText(text)
    .then(() => {
      let btn = document.getElementById('copy-latex-btn');
      btn.textContent = 'âœ…';
      setTimeout(() => btn.textContent = 'ðŸ“‹', 800);
    });
};
window.onload = function() {
  updatePrettyInput();
  calculate();
};
function appendCalc(val) {
  const box = document.getElementById('input-box');
  if (!box) return;
  const start = box.selectionStart;
  const end = box.selectionEnd;
  const text = box.value;
  box.value = text.slice(0, start) + val + text.slice(end);
  const caretPos = start + val.length;
  box.setSelectionRange(caretPos, caretPos);
  box.focus();
  updatePrettyInput();
  calculate();
}
function clearCalc() {
  document.getElementById('input-box').value = '';
  updatePrettyInput();
  calculate();
}
function backspace() {
  const box = document.getElementById('input-box');
  const start = box.selectionStart;
  const end = box.selectionEnd;
  if (start === end && start > 0) {
    box.value = box.value.slice(0, start-1) + box.value.slice(end);
    box.setSelectionRange(start-1, start-1);
  } else {
    box.value = box.value.slice(0, start) + box.value.slice(end);
    box.setSelectionRange(start, start);
  }
  box.focus();
  updatePrettyInput();
  calculate();
}
</script>
</body>
</html>
